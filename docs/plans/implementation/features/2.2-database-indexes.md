# Feature 2.2: Database Indexes

**Track:** 2 - Performance
**Dependencies:** None (but coordinate with 1.2 if adding userId index)
**Estimated Tasks:** 6 atomic tasks

## Overview

Add database indexes on frequently queried columns to improve query performance.

---

## Task List

- [ ] 2.2.1a Add index on Invoice.clientId
- [ ] 2.2.1b Add index on Invoice.status
- [ ] 2.2.1c Add index on Invoice.dueDate
- [ ] 2.2.1d Add index on Invoice.createdAt
- [ ] 2.2.2a Add index on Client.archivedAt
- [ ] 2.2.3a Run prisma db push to apply indexes

---

## Task Details

### 2.2.1a Add index on Invoice.clientId

**File:** `prisma/schema.prisma`
**Action:** Add index to Invoice model

**Find the Invoice model and add after the last field but before the closing brace:**
```prisma
  @@index([clientId])
```

**The Invoice model should look like:**
```prisma
model Invoice {
  id            String     @id @default(cuid())
  // ... other fields ...
  lineItems     LineItem[]

  @@index([clientId])
}
```

**Verify:** Index directive added to Invoice model

**Commit:** `feat(2.2.1a): add database index on Invoice.clientId`

---

### 2.2.1b Add index on Invoice.status

**File:** `prisma/schema.prisma`
**Action:** Add index to Invoice model

**Add another index line:**
```prisma
  @@index([status])
```

**Verify:** Index directive added

**Commit:** `feat(2.2.1b): add database index on Invoice.status`

---

### 2.2.1c Add index on Invoice.dueDate

**File:** `prisma/schema.prisma`
**Action:** Add index to Invoice model

**Add another index line:**
```prisma
  @@index([dueDate])
```

**Verify:** Index directive added

**Commit:** `feat(2.2.1c): add database index on Invoice.dueDate`

---

### 2.2.1d Add index on Invoice.createdAt

**File:** `prisma/schema.prisma`
**Action:** Add index to Invoice model

**Add another index line:**
```prisma
  @@index([createdAt])
```

**After all indexes, the Invoice model should end with:**
```prisma
  lineItems     LineItem[]

  @@index([clientId])
  @@index([status])
  @@index([dueDate])
  @@index([createdAt])
}
```

**If Feature 1.2 (tenant isolation) is complete, also add a composite index:**
```prisma
  @@index([userId, status])
  @@index([userId, createdAt])
```

**Verify:** All index directives added

**Commit:** `feat(2.2.1d): add database index on Invoice.createdAt`

---

### 2.2.2a Add index on Client.archivedAt

**File:** `prisma/schema.prisma`
**Action:** Add index to Client model

**Find the Client model and add after the last field but before the closing brace:**
```prisma
  @@index([archivedAt])
```

**If Feature 1.2 (tenant isolation) is complete, also add:**
```prisma
  @@index([userId, archivedAt])
```

**Verify:** Index directive added to Client model

**Commit:** `feat(2.2.2a): add database index on Client.archivedAt`

---

### 2.2.3a Run prisma db push to apply indexes

**Action:** Run command
**Command:**
```bash
npx prisma db push
```

**Verify:** Command completes without errors. Output should mention creating indexes.

**Optional verification - check indexes exist:**
```bash
npx prisma db execute --stdin <<< "SELECT indexname FROM pg_indexes WHERE tablename IN ('Invoice', 'Client');"
```

**Commit:** `feat(2.2.3a): apply database indexes`

---

## Progress Log

| Timestamp | Agent | Action | Task | Commit |
|-----------|-------|--------|------|--------|
| | | | | |
